<%- partial('../partials/header')%>

<!--<div class="container">
  <div class="page-header">
    <h2><%= i18n('Territories') %></h2>
  </div>
</div>-->
<div class="container">
    <% notif_count = territoryTakenNotificationCount + territoryNotCoveredNotificationCount; %>
    <% if (notif_count > 0) { %>
      <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <h4><i class="fa fa-envelope"></i> <%= i18n('Email notifications') %><i class="icon-question-sign" rel="tooltip" data-placement="bottom" title="<%= i18n('Email notifications remind of taken and not covered territories.') %>"></i></h4>
        <%= i18n('Unsent notifications for territory holders') %> 
        <% if (notif_count > 0 && notif_count < 6) { %>
          <span class="badge badge-info">
        <% } else if (notif_count > 5 && notif_count < 11) { %>
          <span class="badge badge-warning">
        <% } else if (notif_count > 10) { %>
          <span class="badge badge-important">
        <% } %>
        <%= (territoryTakenNotificationCount + territoryNotCoveredNotificationCount) %></span>. <a class="btn btn-mini btn-primary" href="territory/actions/sendemails"><%= i18n('Send now') %></a>
      </div>
    <% } %>
</div>

<% if (actionResult.length > 0) { %>
<div class="container">
  <div class="alert alert-info">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <%= i18n(actionResult) %>
    <a class="btn btn-mini btn-primary" href="territory"><%= i18n('Show all') %></a>
  </div>
</div>
<% } %>

<div class="container">
<div class="btn-group pull-right">
  <button class="btn dropdown-toggle" data-toggle="dropdown">
    <i class="fa fa-2x fa-filter"></i><span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
      <li><a href="?only_free=true"><i class="fa fa-fw fa-home"></i> <%= i18n('Available') %></a></li>

      <li><a href="?taken_days_ago=<%= sails.config.limit_for_rarely_covered_territory %>&only_free=false"><i class="fa fa-fw fa-warning"></i> <%= i18n('Not covered') %></a></li>
      
      <li><a href="?type=Business"><i class="fa fa-fw fa-shopping-cart"></i> <%= i18n('Business territories') %></a></li>

      <li><a href="?type=Phone"><i class="fa fa-fw fa-phone"></i> <%= i18n('Phone territories') %></a></li>
      <li class="divider"></li>
      <li>
        <a href="/territory">
          <i class="fa fa-fw fa-power-off"></i> <%= i18n('Filters off') %>
        </a>
      </li>
    </ul>
  </div>
    <% _.each(availableLetters, function (letter) { %>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h2 class="panel-title"><a href="<%= '/territory/' + letter %>"><%= letter %></a></h2>
        </div>
        <div class="panel-body">
          <ul class="inline">
            <% _.each(territories, function (t) { %>
            <% if(letter == t.territoryLetter) { %>

            <% var taken = new Date(t.taken); taken = taken.getTime(); var now = new Date(); var not_covered = now.getTime() - (1000 * 60 * 60 * 24 * sails.config.limit_for_rarely_covered_territory); %>
            <li>
              <a href="<%= '/territory/' + t.territoryLetter + '/' + t.territoryNumber %>">
                <% if(not_covered > taken) { %> 
                  <span style="color:#FF3300">
                <% } %>
                <% if(t.holder == sails.config.default_territory_holder) { %>
                  <b><%= t.territoryCode %></b>
                <% } else { %>
                  <%= t.territoryCode %>
                <% } %>
                <% if(not_covered > taken) { %> 
                  </span>
                <% } %>
              </a>
            </li>
            
            <!--
            <li><%= i18n('Holder') %>: <%= t.holder %></li>
            <li><%= i18n('Taken') %>: <% var taken = new Date(t.taken); %> <%= taken.getFullYear() + '-' + (taken.getMonth()+1) + '-' + taken.getDate() %></li> -->

            <% } %>
            <% }) %>
          </ul>
        </div>
      </div>
    <% }) %>
  <p class="bg-success"><%= i18n('Showing') %> <span class="badge badge-info"><%= territories.length %> / <%= totalCount %></span> <%= i18n('territories') %>.</p>
</div>

<div class="container">
  <ul class="breadcrumb list-inline">
    <li><i class="fa fa-map-marker"></i> <a href="/"><%= i18n('Territories on a map') %></a></li> <span class="lgrey">&diams;</span>
    <li><i class="fa fa-bar-chart-o"></i> <a href="/territory/stats"><%= i18n('Stats') %></a></li> <span class="lgrey">&diams;</span>
    <li><i class="fa fa-columns"></i> <a href="/territory/s13"><%= i18n('S-13') %></a></li>
    <% if(viewOptions.currentUserType && viewOptions.currentUserType != 'restricted') { %>
       <span class="lgrey">&diams;</span>
      <li><i class="fa fa-plus"></i> <a href="/territory/actions/add"><%= i18n('Add new territory') %></a></li>
    <% } %>
    <% if(viewOptions.currentUsername == 'admin') { %>
       <span class="lgrey">&diams;</span>
      <li><i class="fa fa-trash-o"></i> <a href="/territory/destroy"><%= i18n('Remove territory') %></a></li>
    <% } %>
  </ul>
</div>

<%- partial('../partials/footer') %>
<script type="text/javascript" src="/js/jquery.js"></script>
<script>
  jQuery(function ($) {
    $("i").tooltip()
  });
</script>